<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- å…³é”®ï¼šviewport è®¾ç½®ç¦æ­¢ç¼©æ”¾ï¼Œä¸”é€‚é…åˆ˜æµ·å± -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SCL-90 æ·±åº¦å¿ƒç†æµ‹è¯„æŠ¥å‘Š</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* iOS é«˜åº¦ä¿®æ­£ & å…¨å±€è®¾ç½® */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* ç¦æ­¢ body æ»šåŠ¨ï¼Œäº¤ç”±å†…éƒ¨å®¹å™¨æ»šåŠ¨ */
            background-color: #F2F4F6;
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
            /* é’ˆå¯¹ iOS Safari çš„é«˜åº¦ä¿®å¤ */
            height: -webkit-fill-available; 
        }

        .font-num { font-family: 'Outfit', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .report-bg {
            background-color: #ffffff;
            background-image: radial-gradient(#F1F5F9 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .glass-nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .text-gradient-title {
            background: linear-gradient(45deg, #FF2442 0%, #FF6B6B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .progress-gradient {
            background: linear-gradient(90deg, #FF9A9E 0%, #FF2442 100%);
            box-shadow: 0 0 10px rgba(255, 36, 66, 0.3);
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }

        .slide-next-enter-active, .slide-next-leave-active { transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); position: absolute; width: 100%; }
        .slide-next-enter-from { opacity: 0; transform: translateX(50px); }
        .slide-next-leave-to { opacity: 0; transform: translateX(-50px); }

        .slide-prev-enter-active, .slide-prev-leave-active { transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); position: absolute; width: 100%; }
        .slide-prev-enter-from { opacity: 0; transform: translateX(-50px); }
        .slide-prev-leave-to { opacity: 0; transform: translateX(50px); }

        .bg-fade-enter-active, .bg-fade-leave-active { transition: opacity 1.0s ease; }
        .bg-fade-enter-from, .bg-fade-leave-to { opacity: 0; }
        
        .modal-enter-active, .modal-leave-active { transition: all 0.3s ease; }
        .modal-enter-from, .modal-leave-to { opacity: 0; transform: scale(1.05); }

        /* é€‚é…åˆ˜æµ·å±å’Œåº•éƒ¨é»‘æ¡ */
        .safe-padding-top { padding-top: env(safe-area-inset-top); }
        .safe-padding-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-margin-bottom { margin-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>

    <!-- ä¸»å®¹å™¨ï¼šä½¿ç”¨ h-full å’Œ fixed å¸ƒå±€æ¥ç¡®ä¿åœ¨ iOS ä¸Šä¸ä¹±è·‘ -->
    <!-- pt-safe æ”¹ä¸ºé€šè¿‡ safe-padding-top ç±»æ§åˆ¶ -->
    <div id="app" class="w-full max-w-md mx-auto h-full bg-white shadow-2xl relative overflow-hidden flex flex-col safe-padding-top">
        
        <!-- 0. è€ƒå‰å¼•å¯¼å¼¹çª— -->
        <transition name="modal">
            <div v-if="showStartModal" class="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/90 backdrop-blur-sm" @touchmove.prevent>
                <div class="bg-white w-full max-w-sm rounded-3xl p-8 shadow-2xl text-center relative overflow-hidden animate-float">
                    <div class="absolute top-0 left-0 w-full h-2 bg-[#FF2442]"></div>
                    <div class="mb-6 mt-2">
                        <span class="text-6xl">ğŸ¤«</span>
                    </div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-4">ä¿æŒå†…å¿ƒå¹³é™</h3>
                    <div class="text-slate-500 text-sm leading-relaxed mb-8 text-left bg-slate-50 p-4 rounded-xl border border-slate-100">
                        <p class="mb-2">ğŸ¯ <b>è¯·å‡­ç›´è§‰å›ç­”</b><br>ä¸è¦è¿‡å¤šæ€è€ƒï¼Œç¬¬ä¸€ååº”æœ€å‡†ç¡®ã€‚</p>
                        <p>ğŸ”‡ <b>ç¯å¢ƒè¦æ±‚</b><br>è¯·ç¡®ä¿æ¥ä¸‹æ¥10åˆ†é’Ÿä¸è¢«æ‰“æ‰°ã€‚</p>
                    </div>
                    
                    <button v-if="countdown > 0" disabled class="w-full bg-slate-100 text-slate-400 py-4 rounded-xl font-bold text-lg cursor-not-allowed transition-colors flex items-center justify-center gap-2">
                        <svg class="animate-spin h-5 w-5 text-slate-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                        é˜…è¯»é¡»çŸ¥ ({{ countdown }}s)
                    </button>
                    
                    <button v-else @click="confirmStart" class="w-full bg-[#FF2442] hover:bg-[#e61e3a] text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-red-200 transition-transform active:scale-95 safe-margin-bottom">
                        æˆ‘å‡†å¤‡å¥½äº†
                    </button>
                </div>
            </div>
        </transition>

        <!-- 1. å°é¢é¡µ (é‡ç‚¹ä¿®å¤åŒºåŸŸ) -->
        <!-- ä½¿ç”¨ flex-col å’Œ justify-center + gapï¼Œé¿å…ä½¿ç”¨ justify-around å¯¼è‡´çš„å¸ƒå±€æ¾æ•£ -->
        <div v-if="step === 'cover'" class="flex-1 flex flex-col items-center justify-center gap-6 p-8 bg-gradient-to-b from-rose-50 via-white to-white text-center relative z-10 overflow-y-auto safe-padding-bottom">
            <div class="absolute top-[-10%] right-[-10%] w-40 h-40 bg-red-100 rounded-full blur-3xl opacity-50"></div>
            
            <!-- ä¿®å¤ï¼šå›¾ç‰‡ä½¿ç”¨ç™¾åˆ†æ¯”å®½åº¦ï¼Œåœ¨å°å±ä¸Šè‡ªåŠ¨ç¼©å°ï¼Œé¿å…æŒ¤å‹å†…å®¹ -->
            <div class="w-[45vw] max-w-[200px] aspect-square animate-float relative z-10 flex-shrink-0">
                <svg viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg" class="w-full h-full drop-shadow-2xl rounded-[2.5rem]">
                  <defs>
                    <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" style="stop-color:#FF9A9E;stop-opacity:1" />
                      <stop offset="100%" style="stop-color:#FECFEF;stop-opacity:1" />
                    </linearGradient>
                  </defs>
                  <rect width="800" height="800" fill="url(#grad1)" />
                  <circle cx="400" cy="400" r="300" fill="rgba(255,255,255,0.3)" />
                  <path d="M400 250 C200 250, 200 550, 400 550 C600 550, 600 250, 400 250" fill="white" fill-opacity="0.8"/>
                  <circle cx="320" cy="380" r="30" fill="#FF2442" fill-opacity="0.6"/>
                  <circle cx="480" cy="380" r="30" fill="#FF2442" fill-opacity="0.6"/>
                  <text x="400" y="680" font-family="sans-serif" font-size="60" fill="#FF2442" text-anchor="middle" font-weight="bold" letter-spacing="10">SELF-CHECK</text>
                </svg>
            </div>

            <div class="relative z-10 flex-shrink-0 w-full">
                <div class="inline-block px-3 py-1 bg-red-50 text-red-500 rounded-full text-xs font-bold mb-3 tracking-wide border border-red-100">
                    å›½é™…å…¬è®¤æ ‡å‡† â€¢ 90é¡¹æŒ‡æ ‡
                </div>
                <h1 class="text-4xl font-black mb-2 tracking-tight leading-tight text-gradient-title">
                    SCL-90<br>æ·±åº¦å¿ƒç†æµ‹è¯„
                </h1>
                <p class="text-slate-400 text-sm font-medium px-4">
                    åƒä½“æ£€ä¸€æ ·ï¼Œç»™å¿ƒçµåšä¸€æ¬¡å…¨é¢æ‰«æ<br>
                    <span class="text-xs opacity-70">é¢„è®¡ç”¨æ—¶ 10-15 åˆ†é’Ÿ</span>
                </p>
            </div>

            <div class="w-full relative z-10 flex-shrink-0 mt-auto mb-4">
                <button @click="triggerStartModal" class="btn-active w-full bg-[#FF2442] hover:bg-[#e61e3a] text-white py-4 rounded-2xl font-bold text-lg shadow-lg shadow-red-200 flex items-center justify-center gap-2 transition-colors relative overflow-hidden group">
                    <div class="absolute inset-0 bg-white opacity-0 group-hover:opacity-10 transition-opacity"></div>
                    <span>å¼€å§‹æ¢ç´¢çœŸå®çš„è‡ªå·±</span>
                </button>
                
                <p class="text-[10px] text-slate-300 mt-4">ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸ä½œä¸ºåŒ»å­¦è¯Šæ–­ä¾æ®</p>
            </div>
        </div>

        <!-- 2. ç­”é¢˜é¡µ -->
        <div v-else-if="step === 'test'" class="flex-1 flex flex-col bg-slate-50 relative overflow-hidden">
            <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
            <div class="pt-4 px-5 pb-3 bg-white/95 backdrop-blur-md z-30 shadow-sm rounded-b-3xl sticky top-0">
                <div class="h-8 mb-2 flex items-center justify-between relative">
                    <div class="flex items-center gap-2 min-w-[60px]">
                        <transition name="fade">
                            <button v-if="currentQuestionIndex > 0" @click="prevQuestion" class="group flex items-center gap-1 pl-2 pr-3 py-1 rounded-full bg-slate-100 hover:bg-slate-200 text-slate-600 transition-all active:scale-95">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7" /></svg>
                                <span class="text-[11px] font-bold">ä¸Šä¸€é¢˜</span>
                            </button>
                        </transition>
                    </div>
                    <div class="absolute left-1/2 -translate-x-1/2">
                         <span class="text-[11px] font-bold text-[#FF2442] tracking-wide opacity-90 bg-red-50 px-2 py-0.5 rounded-full">
                            {{ progressAdvice }}
                        </span>
                    </div>
                    <div class="flex items-baseline gap-0.5 font-num min-w-[60px] justify-end">
                        <span class="text-lg font-bold text-slate-700">{{ currentQuestionIndex + 1 }}</span>
                        <span class="text-[10px] text-slate-400 font-medium">/ {{ questions.length }}</span>
                    </div>
                </div>
                <div class="h-1.5 bg-slate-100 rounded-full overflow-hidden w-full">
                    <div class="h-full progress-gradient transition-all duration-500 ease-out rounded-full" :style="{ width: progress + '%' }"></div>
                </div>
            </div>
            
            <!-- ç­”é¢˜åŒºåŸŸ -->
            <div class="flex-1 flex flex-col relative w-full max-w-md mx-auto">
                <transition :name="transitionName">
                    <div :key="currentQuestionIndex" class="absolute inset-0 p-4 pt-2 flex flex-col h-full overflow-y-auto no-scrollbar safe-padding-bottom">
                        
                        <!-- é¢˜ç›®å¡ç‰‡ -->
                        <div class="flex-shrink-0 relative p-5 rounded-[1.5rem] shadow-lg text-center mb-4 min-h-[160px] flex flex-col items-center justify-center overflow-hidden border border-white/50 group bg-white">
                            <div class="absolute inset-0 z-0">
                                <transition name="bg-fade">
                                    <img :key="currentMoodImage" :src="currentMoodImage" class="w-full h-full object-cover opacity-80 blur-[1px]" alt="mood">
                                </transition>
                            </div>
                            <div class="absolute inset-0 z-10 bg-white/85 backdrop-blur-[1px]"></div>
                            <div class="relative z-20 w-full">
                                <span class="text-[10px] text-slate-400 font-bold tracking-widest uppercase mb-1.5 block">QUESTION {{ currentQuestionIndex + 1 }}</span>
                                <h2 class="text-lg font-bold text-slate-800 leading-snug drop-shadow-sm px-2">
                                    {{ questions[currentQuestionIndex].text }}
                                </h2>
                            </div>
                        </div>

                        <!-- é€‰é¡¹åˆ—è¡¨ -->
                        <div class="flex-grow flex flex-col justify-center gap-2.5 pb-4">
                            <button v-for="(option, val) in optionsWithEmojis" :key="val" 
                                @click="handleSelect(val)"
                                :disabled="isTransitioning"
                                class="w-full p-3 rounded-xl transition-all duration-150 flex items-center justify-between group relative overflow-hidden border shadow-sm active:scale-[0.98]"
                                :class="[
                                    tempSelectedOption == val 
                                        ? 'bg-[#FF2442] text-white border-transparent shadow-red-200 ring-2 ring-red-100' 
                                        : 'bg-white border-slate-100 text-slate-600 hover:border-red-200'
                                ]"
                            >
                                <div class="flex items-center gap-3 relative z-10">
                                    <span class="text-xl">{{ option.emoji }}</span>
                                    <span class="font-bold text-sm">{{ option.text }}</span>
                                </div>
                                <div class="w-4 h-4 rounded-full border-2 flex-shrink-0 flex items-center justify-center transition-colors relative z-10"
                                     :class="tempSelectedOption == val ? 'border-white' : 'border-slate-200'">
                                    <div class="w-2 h-2 rounded-full transition-opacity"
                                         :class="[tempSelectedOption == val ? 'bg-white opacity-100' : 'bg-transparent opacity-0']"></div>
                                </div>
                            </button>
                        </div>
                    </div>
                </transition>
            </div>
        </div>

        <!-- 3. ç»“æœæ¦‚è§ˆé¡µ -->
        <div v-else-if="step === 'result'" class="flex-1 flex flex-col bg-[#F2F4F6] overflow-y-auto no-scrollbar relative h-full">
            <div class="glass-nav px-4 py-3 shadow-sm flex justify-between items-center sticky top-0 z-40 border-b border-white/50">
                <span class="font-bold text-slate-800 text-sm">ğŸ“‹ æµ‹è¯„æ¡£æ¡ˆ</span>
                <button @click="downloadReport('report-capture')" class="bg-slate-900 text-white text-xs px-4 py-2 rounded-full font-medium hover:bg-slate-700 transition-colors flex items-center gap-1 shadow-lg shadow-slate-300/50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    ä¿å­˜æŠ¥å‘Š
                </button>
            </div>

            <div class="p-4 pb-20 overflow-y-auto safe-padding-bottom" id="report-capture">
                <div class="report-bg rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
                    <div class="bg-slate-900 text-white p-6 pb-12 relative overflow-hidden">
                        <div class="absolute top-[-50%] right-[-20%] w-64 h-64 bg-[#FF2442] rounded-full opacity-20 blur-3xl"></div>
                        <div class="absolute bottom-[-20%] left-[-10%] w-40 h-40 bg-blue-500 rounded-full opacity-20 blur-3xl"></div>
                        <div class="flex justify-between items-start relative z-10">
                            <div>
                                <h1 class="text-2xl font-bold mb-1">å¿ƒç†å¥åº·ç”»åƒ</h1>
                                <p class="text-slate-400 text-xs font-num tracking-wider uppercase">SCL-90 / REF: {{ Math.floor(Math.random()*100000) }}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-3xl font-bold font-num">{{ totalScore }}</p>
                                <p class="text-[10px] text-slate-400 uppercase">Total Score</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mx-4 -mt-8 relative z-10 bg-white p-5 rounded-2xl shadow-lg border-l-4" :class="dynamicAssessment.borderColor">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs text-slate-400 uppercase font-bold tracking-wide">ç»¼åˆçŠ¶æ€è¯„ä¼°</span>
                            <span class="px-2 py-1 rounded text-xs font-bold" :class="dynamicAssessment.badgeClass">
                                {{ dynamicAssessment.title }}
                            </span>
                        </div>
                        <p class="text-sm text-slate-600 leading-relaxed text-justify">
                            {{ dynamicAssessment.text }}
                        </p>
                    </div>

                    <div class="p-6">
                        <h4 class="font-bold text-slate-800 text-sm mb-4 flex items-center">
                            <span class="w-1 h-4 bg-[#FF2442] rounded-full mr-2"></span>
                            ç—‡çŠ¶åˆ†å¸ƒé›·è¾¾
                        </h4>
                        <div class="w-full aspect-square max-h-[260px] relative flex items-center justify-center">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                    <div class="grid grid-cols-3 gap-3 px-4 mb-6">
                        <div class="bg-slate-50 p-3 rounded-xl text-center border border-slate-100">
                            <p class="text-xs text-slate-400 mb-1">å¹³å‡åˆ†</p>
                            <p class="text-xl font-bold text-slate-800 font-num">{{ avgScore }}</p>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-xl text-center border border-slate-100">
                            <p class="text-xs text-slate-400 mb-1">é˜³æ€§é¡¹ç›®</p>
                            <p class="text-xl font-bold text-[#FF2442] font-num">{{ positiveItems }}</p>
                            <p class="text-[10px] text-slate-400">/ 90</p>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-xl text-center border border-slate-100">
                            <p class="text-xs text-slate-400 mb-1">é˜´æ€§é¡¹ç›®</p>
                            <p class="text-xl font-bold text-green-600 font-num">{{ 90 - positiveItems }}</p>
                        </div>
                    </div>

                    <div class="px-4 mb-6">
                        <h4 class="font-bold text-slate-800 text-sm mb-4 flex items-center">
                            <span class="w-1 h-4 bg-blue-500 rounded-full mr-2"></span>
                            æ·±åº¦å› å­è§£ç 
                        </h4>
                        <div class="grid grid-cols-[25%_25%_20%_30%] gap-2 mb-2 px-2">
                            <div class="text-[10px] font-bold text-slate-400">å› å­åç§°</div>
                            <div class="text-[10px] font-bold text-slate-400 text-center">å‡åˆ†</div>
                            <div class="text-[10px] font-bold text-slate-400 text-center">æ€»åˆ†</div>
                            <div class="text-[10px] font-bold text-slate-400 text-right">çŠ¶æ€è¯„çº§</div>
                        </div>
                        <div class="space-y-2">
                            <div v-for="factor in factors" :key="factor.name" class="bg-white p-3 rounded-xl border border-slate-100 shadow-sm grid grid-cols-[25%_25%_20%_30%] gap-2 items-center">
                                <div class="text-sm font-bold text-slate-700 truncate">{{ factor.name }}</div>
                                <div class="text-center">
                                    <span class="text-sm font-bold font-num" :class="getTextColorClass(factor.score)">
                                        {{ factor.score.toFixed(2) }}
                                    </span>
                                </div>
                                <div class="text-center">
                                    <span class="text-xs font-bold text-slate-500 font-num">{{ factor.rawSum }}</span>
                                </div>
                                <div class="flex justify-end">
                                    <span class="text-[10px] px-2 py-1 rounded font-bold" :class="getStatusBadgeClass(factor.score)">
                                        {{ getLevelText(factor.score) }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="px-4 mb-6">
                        <button @click="goToDetail" class="w-full py-4 bg-white border-2 border-slate-100 rounded-2xl text-slate-600 font-bold flex items-center justify-center gap-2 hover:bg-slate-50 hover:border-slate-200 transition-colors shadow-sm">
                            <span>ğŸ“– æŸ¥çœ‹è¯¦ç»†å› å­åˆ†æ</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                    
                    <div class="text-center py-6 bg-slate-900">
                        <p class="text-[10px] text-slate-500 mt-1">SCL-90 Â· å¿ƒç†æ¡£æ¡ˆ (ä»…ä¾›å‚è€ƒ)</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. æ·±åº¦è¯¦ç»†åˆ†æé¡µ -->
        <div v-else-if="step === 'result-detail'" class="flex-1 flex flex-col bg-[#F2F4F6] overflow-y-auto no-scrollbar relative h-full">
            <div class="glass-nav px-4 py-3 shadow-sm flex justify-between items-center sticky top-0 z-40 border-b border-white/50">
                <button @click="backToSummary" class="text-slate-600 flex items-center gap-1 text-sm font-bold bg-slate-100 px-3 py-1.5 rounded-full hover:bg-slate-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    è¿”å›æ¦‚è§ˆ
                </button>
                <button @click="downloadReport('detail-capture')" class="bg-slate-900 text-white text-xs px-4 py-2 rounded-full font-medium hover:bg-slate-700 transition-colors flex items-center gap-1 shadow-lg shadow-slate-300/50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                    ä¿å­˜è¯¦ç»†
                </button>
            </div>

            <div class="p-4 pb-20 overflow-y-auto safe-padding-bottom" id="detail-capture">
                <div class="mb-6 text-center">
                    <h2 class="text-2xl font-bold text-slate-800">æ·±åº¦å› å­è§£æ</h2>
                    <p class="text-xs text-slate-400 mt-1">åŸºäºæ‚¨æœ¬æ¬¡æµ‹è¯•ç»“æœçš„è¯¦ç»†è§£è¯»</p>
                </div>

                <div class="space-y-4">
                    <div v-for="factor in factors" :key="factor.name" class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                        <div class="flex justify-between items-start mb-3 border-b border-slate-50 pb-3">
                            <div>
                                <h3 class="font-bold text-lg text-slate-800">{{ factor.name }}</h3>
                                <p class="text-[10px] text-slate-400">{{ getFactorDesc(factor.name) }}</p>
                            </div>
                            <div class="text-right">
                                <span class="block text-2xl font-bold font-num" :class="getTextColorClass(factor.score)">{{ factor.score.toFixed(2) }}</span>
                                <span class="text-[10px] px-2 py-0.5 rounded font-bold" :class="getStatusBadgeClass(factor.score)">{{ getLevelText(factor.score) }}</span>
                            </div>
                        </div>
                        
                        <div class="bg-slate-50 rounded-xl p-3 text-sm text-slate-600 leading-relaxed">
                            <span class="font-bold text-slate-700 block mb-1 text-xs">ğŸ’¡ ä¸“å®¶è§£è¯»ï¼š</span>
                            {{ getFactorAnalysis(factor.name, factor.score) }}
                        </div>
                    </div>
                </div>

                <div class="mt-8 text-center pb-4">
                    <p class="text-[10px] text-slate-300">SCL-90 Detail Analysis</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    step: 'cover',
                    showStartModal: false,
                    countdown: 3,
                    currentQuestionIndex: 0,
                    tempSelectedOption: null,
                    isTransitioning: false,
                    transitionName: 'slide-next',
                    chartInstance: null, // å­˜å‚¨å›¾è¡¨å®ä¾‹
                    answers: [],
                    optionsWithEmojis: {
                        1: { text: "ä»æ—  (æ²¡æœ‰æ„Ÿè§‰)", emoji: "ğŸ˜¶" },
                        2: { text: "è½»åº¦ (å¶æœ‰ï¼Œä¸å½±å“)", emoji: "ğŸ˜" },
                        3: { text: "ä¸­åº¦ (æœ‰çš„ï¼Œæœ‰ä¸€å®šå½±å“)", emoji: "ğŸ˜Ÿ" },
                        4: { text: "åé‡ (å¸¸æœ‰ï¼Œå½±å“è¾ƒå¤§)", emoji: "ğŸ˜«" },
                        5: { text: "ä¸¥é‡ (ååˆ†ä¸¥é‡)", emoji: "ğŸ¥µ" }
                    },
                    factorDefinitions: [
                        { name: 'èº¯ä½“åŒ–', ids: [1,4,12,27,40,42,48,49,53,56,58,86] },
                        { name: 'å¼ºè¿«ç—‡çŠ¶', ids: [3,9,10,28,38,45,46,51,55,65] },
                        { name: 'äººé™…æ•æ„Ÿ', ids: [6,21,34,36,37,41,61,69,73] },
                        { name: 'æŠ‘éƒ', ids: [5,14,15,20,22,26,29,30,31,32,54,71,79] },
                        { name: 'ç„¦è™‘', ids: [2,17,23,33,39,57,72,78,80,81] },
                        { name: 'æ•Œå¯¹', ids: [11,24,63,67,74,81] },
                        { name: 'ææ€–', ids: [13,25,47,50,70,75,82] },
                        { name: 'åæ‰§', ids: [8,18,43,68,76,83] },
                        { name: 'ç²¾ç¥ç—…æ€§', ids: [7,16,35,62,77,84,85,87,88,90] }
                    ],
                    // ä¼˜åŒ–åçš„ 20-50 å­—ç²¾ç®€ç‰ˆåˆ†æ
                    factorInfo: {
                        'èº¯ä½“åŒ–': {
                            desc: 'èº«ä½“ä¸é€‚æ„Ÿçš„æŠ•å°„',
                            analysis: {
                                low: 'æ‚¨çš„èº«å¿ƒçŠ¶æ€å¹³è¡¡ï¼Œèº«ä½“æ„Ÿè§‰è‰¯å¥½ï¼Œæ²¡æœ‰å› å¿ƒç†å› ç´ å¯¼è‡´çš„ä¸é€‚ï¼Œè¯·ç»§ç»­ä¿æŒè¿™ç§å¥åº·çš„ç”Ÿæ´»çŠ¶æ€ã€‚',
                                mid: 'è¿‘æœŸå¯èƒ½å¶æœ‰å¤´ç—›æˆ–èƒƒéƒ¨ä¸é€‚ï¼Œè¿™æˆ–è®¸æ˜¯èº«ä½“åœ¨æé†’æ‚¨è¯¥ä¼‘æ¯äº†ï¼Œå»ºè®®é€‚åº¦æ”¾æ¾ï¼Œç¼“è§£ç–²åŠ³ã€‚',
                                high: 'èº¯ä½“ä¸é€‚æ„Ÿæ˜æ˜¾ï¼Œå¯èƒ½æ˜¯å¿ƒç†å‹åŠ›è½¬åŒ–ä¸ºç”Ÿç†ååº”ã€‚åœ¨æ’é™¤å™¨è´¨æ€§ç—…å˜åï¼Œå»ºè®®è¿›è¡Œèº«å¿ƒæ”¾æ¾è®­ç»ƒã€‚'
                            }
                        },
                        'å¼ºè¿«ç—‡çŠ¶': {
                            desc: 'æ— æ³•æ‘†è„±çš„æ— æ„ä¹‰æ€æƒ³æˆ–å†²åŠ¨',
                            analysis: {
                                low: 'æ€ç»´çµæ´»å¼€æ”¾ï¼Œæ²¡æœ‰åˆ»æ¿æˆ–é‡å¤çš„å¼ºè¿«è¡Œä¸ºï¼Œåšäº‹æ•ˆç‡é«˜ï¼Œå¿ƒæ€è½»æ¾ã€‚',
                                mid: 'å¶æœ‰åå¤æ£€æŸ¥æˆ–æ€è™‘è¿‡å¤šçš„æƒ…å†µï¼Œä½†è¿™æœªå½±å“ç”Ÿæ´»ã€‚å»ºè®®å‡å°‘å¯¹å®Œç¾çš„è¿‡åº¦è¿½æ±‚ï¼Œå…è®¸é€‚åº¦çš„ä¸ç¡®å®šæ€§ã€‚',
                                high: 'å¼ºè¿«å€¾å‘è¾ƒæ˜æ˜¾ï¼Œå¸¸è¢«åå¤å‡ºç°çš„å¿µå¤´å›°æ‰°ã€‚å»ºè®®å°è¯•"é¡ºå…¶è‡ªç„¶ï¼Œä¸ºæ‰€å½“ä¸º"ï¼Œå‡å°‘å¯¹æ€ç»´çš„å¯¹æŠ—ã€‚'
                            }
                        },
                        'äººé™…æ•æ„Ÿ': {
                            desc: 'ç¤¾äº¤ä¸­çš„è‡ªå‘æˆ–ä¸è‡ªåœ¨',
                            analysis: {
                                low: 'åœ¨äººé™…äº¤å¾€ä¸­è¡¨ç°è‡ªä¿¡ã€å¤§æ–¹ï¼Œèƒ½èˆ’é€‚åœ°å¤„ç†äººé™…å…³ç³»ï¼Œäº«å—ç¤¾äº¤å¸¦æ¥çš„ä¹è¶£ã€‚',
                                mid: 'åœ¨ç‰¹å®šç¤¾äº¤åœºåˆå¯èƒ½æ„Ÿåˆ°å±€ä¿ƒï¼Œæˆ–åœ¨æ„ä»–äººè¯„ä»·ã€‚è¿™æ˜¯å¸¸è§çš„ç¤¾äº¤ååº”ï¼Œå»ºç«‹è‡ªä¿¡å¯æœ‰æ•ˆæ”¹å–„ã€‚',
                                high: 'äººé™…äº¤å¾€ä¸­å‹åŠ›è¾ƒå¤§ï¼Œå®¹æ˜“è‡ªå‘æˆ–è¯¯è§£ä»–äººã€‚å»ºè®®å…ˆä»ç†Ÿæ‚‰çš„ç¤¾äº¤åœˆå¼€å§‹ï¼Œé€æ­¥ç»ƒä¹ è¡¨è¾¾çœŸå®çš„è‡ªå·±ã€‚'
                            }
                        },
                        'æŠ‘éƒ': {
                            desc: 'è‹¦é—·æƒ…æ„Ÿä¸ç”Ÿæ´»å…´è¶£å‡é€€',
                            analysis: {
                                low: 'æƒ…ç»ªç§¯æä¹è§‚ï¼Œå¯¹ç”Ÿæ´»å……æ»¡çƒ­æƒ…å’ŒåŠ¨åŠ›ï¼Œå¿ƒç†èƒ½é‡å……è¶³ï¼Œèƒ½å¤Ÿä»æ—¥å¸¸ç”Ÿæ´»ä¸­è·å¾—å¿«ä¹ã€‚',
                                mid: 'è¿‘æœŸæƒ…ç»ªç¨æ˜¾ä½è½ï¼Œå¯èƒ½æ„Ÿåˆ°ç”Ÿæ´»ä¹å‘³ã€‚å»ºè®®å¤šæ™’å¤ªé˜³ï¼Œè¿›è¡Œæœ‰æ°§è¿åŠ¨ï¼Œä¸»åŠ¨å¯»æ‰¾ç”Ÿæ´»ä¸­çš„å°ç¡®å¹¸ã€‚',
                                high: 'æƒ…ç»ªä½è½æ˜æ˜¾ï¼Œå¯èƒ½ä¼´æœ‰æ— åŠ©æ„Ÿã€‚è¯·ä¸è¦ç‹¬è‡ªæ‰¿å—ï¼Œå‘äº²å‹å€¾è¯‰æˆ–å¯»æ±‚ä¸“ä¸šå¸®åŠ©æ˜¯èµ°å‡ºé˜´éœ¾çš„ç¬¬ä¸€æ­¥ã€‚'
                            }
                        },
                        'ç„¦è™‘': {
                            desc: 'æ— åç´§å¼ ä¸ç¥ç»è¿‡æ•',
                            analysis: {
                                low: 'å†…å¿ƒå¹³é™å®‰å®ï¼Œæƒ…ç»ªç¨³å®šæ€§å¥½ï¼Œé¢å¯¹æŒ‘æˆ˜æ—¶èƒ½ä¿æŒæ²‰ç€å†·é™ï¼Œä¸æ˜“å—ç„¦è™‘å¹²æ‰°ã€‚',
                                mid: 'é¢ä¸´å‹åŠ›æ—¶ä¼šæœ‰æ­£å¸¸çš„ç´§å¼ æ„Ÿã€‚å°è¯•æ·±å‘¼å¸æˆ–å†¥æƒ³ï¼Œå°†æ³¨æ„åŠ›é›†ä¸­åœ¨å½“ä¸‹ï¼Œæœ‰åŠ©äºç¼“è§£ç„¦è™‘ã€‚',
                                high: 'ç„¦è™‘æ°´å¹³è¾ƒé«˜ï¼Œå¸¸æ„Ÿè«åçš„ææ…Œæˆ–åç«‹ä¸å®‰ã€‚å»ºè®®ç»ƒä¹ æ­£å¿µå†¥æƒ³ï¼Œå‡å°‘å¯¹æœªæ¥çš„ç¾éš¾åŒ–æƒ³è±¡ã€‚'
                            }
                        },
                        'æ•Œå¯¹': {
                            desc: 'åŒçƒ¦ã€äº‰è®ºä¸ä¸å¯æ§çš„è„¾æ°”',
                            analysis: {
                                low: 'æ€§æ ¼æ¸©å’Œï¼Œå¾…äººå‹å–„ï¼Œæƒ…ç»ªæ§åˆ¶èƒ½åŠ›å¼ºï¼Œä¸æ˜“ä¸äººå‘ç”Ÿå†²çªï¼Œäººé™…å…³ç³»å’Œè°ã€‚',
                                mid: 'é‡æŒ«æŠ˜æ—¶å¶æœ‰çƒ¦èºæˆ–å‘è„¾æ°”ã€‚å»ºè®®è§‰å¯Ÿæ„¤æ€’èƒŒåçš„éœ€æ±‚ï¼Œå°è¯•ç”¨æ›´å¹³å’Œçš„æ–¹å¼è¡¨è¾¾ä¸æ»¡ã€‚',
                                high: 'å†…å¿ƒç§¯å‹äº†è¾ƒå¤šæ„¤æ€’ï¼Œæ˜“å‘ç”Ÿå†²çªã€‚å»ºè®®å¯»æ‰¾å¥åº·çš„å®£æ³„æ¸ é“ï¼ˆå¦‚è¿åŠ¨ï¼‰ï¼Œå­¦ä¼šç”¨è¯­è¨€è€Œéæƒ…ç»ªè§£å†³é—®é¢˜ã€‚'
                            }
                        },
                        'ææ€–': {
                            desc: 'å¯¹ç‰¹å®šåœºæ‰€æˆ–æƒ…å¢ƒçš„éç†æ€§ææƒ§',
                            analysis: {
                                low: 'èƒ†å¤§å¿ƒç»†ï¼Œæ²¡æœ‰ç‰¹æ®Šçš„ææƒ§å¿ƒç†ï¼Œèƒ½å¤Ÿè‡ªå¦‚åœ°åœ¨å„ç§åœºåˆæ´»åŠ¨å’Œç¤¾äº¤ã€‚',
                                mid: 'å¯¹æŸäº›ç‰¹å®šåœºåˆï¼ˆå¦‚æ‹¥æŒ¤äººç¾¤ï¼‰æœ‰è½»å¾®ä¸é€‚ï¼Œä½†èƒ½å…‹æœã€‚è¿™ç§è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶å±æ­£å¸¸èŒƒå›´ã€‚',
                                high: 'å­˜åœ¨æ˜æ˜¾çš„ææƒ§å›é¿è¡Œä¸ºï¼Œå¯èƒ½å½±å“ç”Ÿæ´»ã€‚å»ºè®®é‡‡ç”¨ç³»ç»Ÿè„±æ•æ³•ï¼Œç”±è½»åˆ°é‡é€æ­¥æ¥è§¦ææƒ§æºã€‚'
                            }
                        },
                        'åæ‰§': {
                            desc: 'çŒœç–‘ã€æ•Œæ„ä¸å¦„è‡ªå°Šå¤§',
                            analysis: {
                                low: 'ä¿¡ä»»ä»–äººï¼Œæ€ç»´å¼€æ”¾åŒ…å®¹ï¼Œä¸åæ¿€ï¼Œèƒ½å¤Ÿå®¢è§‚åœ°çœ‹å¾…é—®é¢˜ï¼Œäººé™…å…³ç³»èæ´½ã€‚',
                                mid: 'å¶å°”ä¼šå¤šç–‘æˆ–è§‰å¾—ä¸è¢«ç†è§£ã€‚å»ºè®®å¤šæ¢ä½æ€è€ƒï¼Œå»ºç«‹å¯¹ä»–äººçš„åŸºæœ¬ä¿¡ä»»ï¼Œå‡å°‘æ— ç«¯çš„çŒœæƒ³ã€‚',
                                high: 'å€¾å‘äºæŠŠä»–äººå¥½æ„å½“æ¶æ„ï¼Œæ˜“äº§ç”Ÿå¯¹ç«‹æƒ…ç»ªã€‚å»ºè®®æ£€è§†è‡ªå·±çš„è®¤çŸ¥æ¨¡å¼ï¼Œå°è¯•æ¥çº³ä¸åŒçš„è§‚ç‚¹ã€‚'
                            }
                        },
                        'ç²¾ç¥ç—…æ€§': {
                            desc: 'å¹»è§‰ã€å¦„æƒ³æˆ–ç”Ÿæ´»æ–¹å¼é€€ç¼©',
                            analysis: {
                                low: 'æ€ç»´æ¸…æ™°ï¼Œæ„ŸçŸ¥åŠŸèƒ½æ­£å¸¸ï¼Œä¸ç°å®ä¸–ç•Œè¿æ¥ç´§å¯†ï¼Œç”Ÿæ´»æ–¹å¼å¥åº·ç§¯æã€‚',
                                mid: 'å¶æ„Ÿå­¤ç‹¬æˆ–æ€ç»´è·³è·ƒï¼Œé€šå¸¸ä¸æåº¦ç–²åŠ³æœ‰å…³ã€‚å»ºè®®ä¿è¯å……è¶³ç¡çœ ï¼Œé¿å…é•¿æ—¶é—´ç‹¬å¤„ã€‚',
                                high: 'æ€ç»´æˆ–æ„ŸçŸ¥å¯èƒ½å‡ºç°åå·®ï¼Œä¼´æœ‰æ˜æ˜¾çš„å­¤åƒ»ã€‚è¯·åŠ¡å¿…é‡è§†ï¼Œå»ºè®®è¿›è¡Œä¸“ä¸šçš„å¿ƒç†å¥åº·è¯„ä¼°ã€‚'
                            }
                        }
                    },
                    bgLibrary: {
                        'default': 'https://images.unsplash.com/photo-1513002749550-c59d786b8e6c?q=80&w=800&auto=format&fit=crop',
                        'èº¯ä½“åŒ–': 'https://images.unsplash.com/photo-1501854140884-074bf6b243e7?q=80&w=800&auto=format&fit=crop',
                        'å¼ºè¿«ç—‡çŠ¶': 'https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?q=80&w=800&auto=format&fit=crop',
                        'äººé™…æ•æ„Ÿ': 'https://images.unsplash.com/photo-1515600496618-e42b8c76eb7e?q=80&w=800&auto=format&fit=crop',
                        'æŠ‘éƒ': 'https://images.unsplash.com/photo-1516410541197-ae1f67ec1d6d?q=80&w=800&auto=format&fit=crop',
                        'ç„¦è™‘': 'https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?q=80&w=800&auto=format&fit=crop',
                        'æ•Œå¯¹': 'https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?q=80&w=800&auto=format&fit=crop',
                        'ææ€–': 'https://images.unsplash.com/photo-1509024644558-2f56ce76c490?q=80&w=800&auto=format&fit=crop',
                        'åæ‰§': 'https://images.unsplash.com/photo-1520962922320-2038eebab146?q=80&w=800&auto=format&fit=crop',
                        'ç²¾ç¥ç—…æ€§': 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=800&auto=format&fit=crop'
                    },
                    questions: [
                        {id:1, text:"å¤´ç—›"}, {id:2, text:"ç¥ç»è¿‡æ•ï¼Œå¿ƒä¸­ä¸è¸å®"}, {id:3, text:"å¤´è„‘ä¸­æœ‰ä¸å¿…è¦çš„æƒ³æ³•æˆ–å­—å¥ç›˜æ—‹"}, {id:4, text:"å¤´æ™•æˆ–æ˜å€’"}, {id:5, text:"å¯¹å¼‚æ€§çš„å…´è¶£å‡é€€"},
                        {id:6, text:"å¯¹æ—äººè´£å¤‡æ±‚å…¨"}, {id:7, text:"æ„Ÿåˆ°åˆ«äººèƒ½æ§åˆ¶æ‚¨çš„æ€æƒ³"}, {id:8, text:"è´£æ€ªåˆ«äººåˆ¶é€ éº»çƒ¦"}, {id:9, text:"å¿˜æ€§å¤§"}, {id:10, text:"æ‹…å¿ƒè‡ªå·±çš„è¡£é¥°æ•´é½åŠä»ªæ€çš„ç«¯æ­£"},
                        {id:11, text:"å®¹æ˜“çƒ¦æ¼å’Œæ¿€åŠ¨"}, {id:12, text:"èƒ¸ç—›"}, {id:13, text:"å®³æ€•ç©ºæ—·çš„åœºæ‰€æˆ–è¡—é“"}, {id:14, text:"æ„Ÿåˆ°è‡ªå·±çš„ç²¾åŠ›ä¸‹é™ï¼Œæ´»åŠ¨å‡æ…¢"}, {id:15, text:"æƒ³ç»“æŸè‡ªå·±çš„ç”Ÿå‘½"},
                        {id:16, text:"å¬åˆ°æ—äººå¬ä¸åˆ°çš„å£°éŸ³"}, {id:17, text:"å‘æŠ–"}, {id:18, text:"æ„Ÿåˆ°ç»å¤§å¤šæ•°äººä¸å¯ä¿¡"}, {id:19, text:"èƒƒå£ä¸å¥½"}, {id:20, text:"å®¹æ˜“å“­æ³£"},
                        {id:21, text:"åŒå¼‚æ€§ç›¸å¤„æ—¶æ„Ÿåˆ°å®³ç¾ä¸è‡ªåœ¨"}, {id:22, text:"æ„Ÿåˆ°å—éª—ï¼Œä¸­äº†åœˆå¥—æˆ–æœ‰äººæƒ³æŠ“ä½æ‚¨"}, {id:23, text:"æ— ç¼˜æ— æ•…åœ°çªç„¶æ„Ÿåˆ°å®³æ€•"}, {id:24, text:"è‡ªå·±ä¸èƒ½æ§åˆ¶åœ°å‘è„¾æ°”"}, {id:25, text:"æ€•å•ç‹¬å‡ºé—¨"},
                        {id:26, text:"ç»å¸¸è´£æ€ªè‡ªå·±"}, {id:27, text:"è…°ç—›"}, {id:28, text:"æ„Ÿåˆ°éš¾ä»¥å®Œæˆä»»åŠ¡"}, {id:29, text:"æ„Ÿåˆ°å­¤ç‹¬"}, {id:30, text:"æ„Ÿåˆ°è‹¦é—·"},
                        {id:31, text:"è¿‡åˆ†æ‹…å¿§"}, {id:32, text:"å¯¹äº‹ç‰©ä¸æ„Ÿå…´è¶£"}, {id:33, text:"æ„Ÿåˆ°å®³æ€•"}, {id:34, text:"æ‚¨çš„æƒ…æ„Ÿå®¹æ˜“å—åˆ°ä¼¤å®³"}, {id:35, text:"æ—äººèƒ½çŸ¥é“æ‚¨çš„ç§ä¸‹æƒ³æ³•"},
                        {id:36, text:"æ„Ÿåˆ°åˆ«äººä¸ç†è§£æ‚¨ã€ä¸åŒæƒ…æ‚¨"}, {id:37, text:"æ„Ÿåˆ°äººä»¬å¯¹æ‚¨ä¸å‹å¥½ï¼Œä¸å–œæ¬¢æ‚¨"}, {id:38, text:"åšäº‹å¿…é¡»åšå¾—å¾ˆæ…¢ä»¥ä¿è¯åšå¾—æ­£ç¡®"}, {id:39, text:"å¿ƒè·³å¾—å¾ˆå‰å®³"}, {id:40, text:"æ¶å¿ƒæˆ–èƒƒéƒ¨ä¸èˆ’æœ"},
                        {id:41, text:"æ„Ÿåˆ°æ¯”ä¸ä¸Šåˆ«äºº"}, {id:42, text:"è‚Œè‚‰é…¸ç—›"}, {id:43, text:"æ„Ÿåˆ°æœ‰äººåœ¨çœ‹ç€æ‚¨ã€è°ˆè®ºæ‚¨"}, {id:44, text:"éš¾ä»¥å…¥ç¡"}, {id:45, text:"åšäº‹å¿…é¡»åå¤æ£€æŸ¥"},
                        {id:46, text:"éš¾ä»¥ä½œå‡ºå†³å®š"}, {id:47, text:"æ€•ä¹˜ç”µè½¦ã€å…¬å…±æ±½è½¦ã€åœ°é“æˆ–ç«è½¦"}, {id:48, text:"å‘¼å¸æœ‰å›°éš¾"}, {id:49, text:"ä¸€é˜µé˜µå‘å†·æˆ–å‘çƒ­"}, {id:50, text:"å› ä¸ºæ„Ÿåˆ°å®³æ€•è€Œé¿å¼€æŸäº›ä¸œè¥¿ã€åœºåˆæˆ–æ´»åŠ¨"},
                        {id:51, text:"è„‘å­å˜ç©ºäº†"}, {id:52, text:"èº«ä½“å‘éº»æˆ–åˆºç—›"}, {id:53, text:"å–‰å’™æœ‰æ¢—å¡æ„Ÿ"}, {id:54, text:"æ„Ÿåˆ°æ²¡æœ‰å‰é€”ï¼Œæ²¡æœ‰å¸Œæœ›"}, {id:55, text:"ä¸èƒ½é›†ä¸­æ³¨æ„åŠ›"},
                        {id:56, text:"æ„Ÿåˆ°èº«ä½“çš„æŸä¸€éƒ¨åˆ†è½¯å¼±æ— åŠ›"}, {id:57, text:"æ„Ÿåˆ°ç´§å¼ æˆ–å®¹æ˜“ç´§å¼ "}, {id:58, text:"æ„Ÿåˆ°æ‰‹æˆ–è„šå‘é‡"}, {id:59, text:"æƒ³åˆ°æ­»äº¡çš„äº‹"}, {id:60, text:"åƒå¾—å¤ªå¤š"},
                        {id:61, text:"å½“åˆ«äººçœ‹ç€æ‚¨æˆ–è°ˆè®ºæ‚¨æ—¶æ„Ÿåˆ°ä¸è‡ªåœ¨"}, {id:62, text:"æœ‰ä¸€äº›ä¸å±äºæ‚¨è‡ªå·±çš„æƒ³æ³•"}, {id:63, text:"æœ‰æƒ³æ‰“äººæˆ–ä¼¤å®³ä»–äººçš„å†²åŠ¨"}, {id:64, text:"é†’å¾—å¤ªæ—©"}, {id:65, text:"å¿…é¡»åå¤æ´—æ‰‹ã€ç‚¹æ•°ç›®æˆ–è§¦æ‘¸æŸäº›ä¸œè¥¿"},
                        {id:66, text:"ç¡å¾—ä¸ç¨³ä¸æ·±"}, {id:67, text:"æœ‰æƒ³æ‘”åæˆ–ç ´åä¸œè¥¿çš„å†²åŠ¨"}, {id:68, text:"æœ‰äº›äººä¸æ‚¨ä¸ºæ•Œ"}, {id:69, text:"åœ¨å•†åº—æˆ–ç”µå½±é™¢ç­‰äººå¤šçš„åœ°æ–¹æ„Ÿåˆ°ä¸è‡ªåœ¨"}, {id:70, text:"æ„Ÿåˆ°ä»»ä½•äº‹æƒ…éƒ½å¾ˆå›°éš¾"},
                        {id:71, text:"æ„Ÿåˆ°å¿ƒç¥ä¸å®"}, {id:72, text:"æ„Ÿåˆ°è‡ªå·±çš„å¤´ç—›"}, {id:73, text:"ä¸åˆç¾¤"}, {id:74, text:"ç»å¸¸äº‰è®º"}, {id:75, text:"å•ç‹¬ä¸€äººæ—¶ç¥ç»å¾ˆç´§å¼ "},
                        {id:76, text:"åˆ«äººå¯¹æ‚¨çš„æˆç»©æ²¡æœ‰ä½œå‡ºæ°å½“çš„è¯„ä»·"}, {id:77, text:"å³ä½¿å’Œåˆ«äººåœ¨ä¸€èµ·ä¹Ÿæ„Ÿåˆ°å­¤å•"}, {id:78, text:"æ„Ÿåˆ°åç«‹ä¸å®‰"}, {id:79, text:"æ„Ÿåˆ°è‡ªå·±ä¸€æ— æ˜¯å¤„"}, {id:80, text:"æ„Ÿåˆ°ç†Ÿæ‚‰çš„ä¸œè¥¿å˜æˆé™Œç”Ÿæˆ–ä¸åƒæ˜¯çœŸçš„"},
                        {id:81, text:"å¤§å«æˆ–æ‘”ä¸œè¥¿"}, {id:82, text:"å®³æ€•åœ¨å…¬å…±åœºåˆä¼šæ™•å€’"}, {id:83, text:"æ„Ÿåˆ°åˆ«äººæƒ³åˆ©ç”¨æ‚¨"}, {id:84, text:"ä¸ºä¸€äº›æœ‰å…³æ€§çš„æƒ³æ³•è€Œå¾ˆè‹¦æ¼"}, {id:85, text:"æ‚¨è®¤ä¸ºåº”è¯¥å› ä¸ºè‡ªå·±çš„è¿‡é”™è€Œå—åˆ°æƒ©ç½š"},
                        {id:86, text:"æ„Ÿåˆ°è¦èµ¶å¿«æŠŠäº‹æƒ…åšå®Œ"}, {id:87, text:"æ„Ÿåˆ°è‡ªå·±çš„èº«ä½“æœ‰ä¸¥é‡é—®é¢˜"}, {id:88, text:"ä»æœªæ„Ÿåˆ°å’Œå…¶ä»–äººå¾ˆäº²è¿‘"}, {id:89, text:"æ„Ÿåˆ°æœ‰ç½ªæ¶æ„Ÿ"}, {id:90, text:"æ„Ÿåˆ°è‡ªå·±çš„è„‘å­æœ‰æ¯›ç—…"}
                    ],
                    factors: []
                }
            },
            computed: {
                progress() { return ((this.currentQuestionIndex + 1) / this.questions.length) * 100; },
                
                progressAdvice() {
                    const p = this.progress;
                    if (p < 10) return "ğŸš€ æ¢ç´¢å¼€å§‹";
                    if (p < 25) return "âœ¨ ä¿æŒä¸“æ³¨";
                    if (p < 50) return "ğŸŒ¿ æ…¢æ…¢æ¥";
                    if (p < 75) return "ğŸ’ª éå¸¸æ£’";
                    if (p < 90) return "ğŸŒˆ å¿«å®Œæˆäº†";
                    return "ğŸ å³å°†å®Œæˆ";
                },

                currentMoodImage() {
                    const currentQ = this.questions[this.currentQuestionIndex];
                    if(!currentQ) return this.bgLibrary['default'];

                    const qId = currentQ.id;
                    let factorKey = 'default';
                    for(const factor of this.factorDefinitions) {
                        if(factor.ids.includes(qId)) {
                            factorKey = factor.name;
                            break;
                        }
                    }
                    return this.bgLibrary[factorKey] || this.bgLibrary['default'];
                },

                totalScore() { return this.answers.reduce((a, b) => a + b, 0); },
                avgScore() { return this.answers.length ? (this.totalScore / this.answers.length).toFixed(2) : 0; },
                positiveItems() { return this.answers.filter(s => s >= 2).length; },
                
                topRiskFactor() {
                    if (this.factors.length === 0) return null;
                    const risks = this.factors.filter(f => f.score >= 2).sort((a, b) => b.score - a.score);
                    return risks.length > 0 ? risks[0] : null;
                },

                dynamicAssessment() {
                    const avg = parseFloat(this.avgScore);
                    const pos = this.positiveItems;
                    let title = "";
                    let text = "";
                    let borderColor = "";
                    let badgeClass = "";
                    
                    const sortedFactors = [...this.factors].sort((a,b) => b.score - a.score);
                    const maxF = sortedFactors.length > 0 ? sortedFactors[0] : null;

                    if (avg < 1.5 && pos < 15) {
                        title = 'å¿ƒç†é˜³å…‰ â˜€ï¸';
                        borderColor = 'border-green-500';
                        badgeClass = 'bg-green-100 text-green-700';
                        text = "æ‚¨çš„æ•´ä½“å¿ƒç†éŸ§æ€§æä½³ï¼Œæƒ…ç»ªç¨³å®šæ€§å¼ºã€‚ç›®å‰çš„æ‚¨ä¸ä»…æ²¡æœ‰æ˜æ˜¾çš„å¿ƒç†å›°æ‰°ï¼Œåè€Œå±•ç°å‡ºäº†ç§¯æå‘ä¸Šçš„ç”Ÿå‘½åŠ›ã€‚è¿™ç§çŠ¶æ€æœ‰åŠ©äºæ‚¨åº”å¯¹æ—¥å¸¸æŒ‘æˆ˜ï¼Œè¯·ç»§ç»­ä¿æŒè§„å¾‹çš„ä½œæ¯å’Œç¤¾äº¤æ´»åŠ¨ï¼Œäº«å—å½“ä¸‹çš„ç¾å¥½ç”Ÿæ´»ã€‚";
                    } else if (avg < 2.0) {
                        title = 'çŠ¶æ€å¹³ç¨³ ğŸŒ¿';
                        borderColor = 'border-emerald-400';
                        badgeClass = 'bg-emerald-100 text-emerald-700';
                        text = `æ‚¨çš„å¿ƒç†çŠ¶æ€æ€»ä½“å¤„äºå¥åº·èŒƒå›´ã€‚è™½ç„¶åœ¨ä¸ªåˆ«æ–¹é¢ï¼ˆå¦‚${maxF ? maxF.name : 'æŸäº›æ—¶åˆ»'}ï¼‰å¯èƒ½å­˜åœ¨ç»†å¾®çš„æƒ…ç»ªæ³¢åŠ¨ï¼Œä½†è¿™å±äºæ­£å¸¸äººçš„ç”Ÿæ´»ååº”ã€‚å»ºè®®æ‚¨åœ¨å¿™ç¢Œä¹‹ä½™ï¼Œç»™è‡ªå·±ç•™å‡ºä¸€äº›â€œæ”¾ç©ºæ—¶é—´â€ï¼Œä¿æŒåŠ³é€¸ç»“åˆã€‚`;
                    } else if (avg < 3.0) {
                        title = 'è½»åº¦é¢„è­¦ âš ï¸';
                        borderColor = 'border-yellow-400';
                        badgeClass = 'bg-yellow-100 text-yellow-800';
                        text = `æ£€æµ‹åˆ°æ‚¨è¿‘æœŸå¯èƒ½æ‰¿å—äº†ä¸€å®šçš„å¿ƒç†å‹åŠ›ï¼Œå°¤å…¶åœ¨ã€${maxF ? maxF.name : 'æƒ…ç»ª'}ã€‘æ–¹é¢è¡¨ç°å‡ºäº†ä¸€äº›å›°æ‰°ã€‚è¿™å¹¶ä¸æ˜¯ç–¾ç—…çš„ä¿¡å·ï¼Œè€Œæ˜¯èº«å¿ƒåœ¨æé†’æ‚¨â€œéœ€è¦ä¼‘æ¯äº†â€ã€‚å»ºè®®å°è¯•ä¸ä¿¡ä»»çš„æœ‹å‹å€¾è¯‰ï¼Œæˆ–è¿›è¡Œé€‚å½“çš„æˆ·å¤–è¿åŠ¨æ¥é‡Šæ”¾å‹åŠ›ã€‚`;
                    } else {
                        title = 'é‡ç‚¹å…³æ³¨ ğŸ†˜';
                        borderColor = 'border-red-500';
                        badgeClass = 'bg-red-100 text-red-700';
                        text = `æ‚¨çš„æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼Œç›®å‰çš„å¿ƒç†è´Ÿæ‹…è¾ƒé‡ï¼Œä¸”åœ¨å¤šä¸ªç»´åº¦ï¼ˆç‰¹åˆ«æ˜¯${maxF ? maxF.name : 'æƒ…ç»ª'}ï¼‰å­˜åœ¨æ˜æ˜¾çš„ç—›è‹¦ä½“éªŒã€‚è¿™ç§çŠ¶æ€å¯èƒ½ä¼šå½±å“æ‚¨çš„æ—¥å¸¸ç”Ÿæ´»æˆ–å·¥ä½œæ•ˆç‡ã€‚è¯·ä¸è¦ç‹¬è‡ªç¡¬æ‰›ï¼Œå¼ºçƒˆå»ºè®®æ‚¨å¯»æ±‚ä¸“ä¸šçš„å¿ƒç†å’¨è¯¢å¸ˆå¸®åŠ©ï¼Œä¸“ä¸šçš„ç–å¯¼èƒ½è®©æ‚¨æ›´å¿«èµ°å‡ºé˜´éœ¾ã€‚`;
                    }
                    return { title, text, borderColor, badgeClass };
                }
            },
            methods: {
                triggerStartModal() {
                    this.showStartModal = true;
                    this.countdown = 3;
                    const timer = setInterval(() => {
                        this.countdown--;
                        if (this.countdown <= 0) {
                            clearInterval(timer);
                        }
                    }, 1000);
                },
                confirmStart() {
                    this.showStartModal = false;
                    this.step = 'test';
                },
                
                prevQuestion() {
                    if (this.currentQuestionIndex > 0) {
                        this.transitionName = 'slide-prev';
                        this.answers.pop();
                        setTimeout(() => {
                            this.currentQuestionIndex--;
                            this.tempSelectedOption = null;
                        }, 10);
                    }
                },

                handleSelect(val) {
                    if (this.isTransitioning) return; 
                    this.tempSelectedOption = val;
                    this.isTransitioning = true;
                    this.transitionName = 'slide-next';

                    setTimeout(() => {
                        this.answers.push(parseInt(val));
                        if (this.currentQuestionIndex < this.questions.length - 1) {
                            this.currentQuestionIndex++;
                            this.tempSelectedOption = null;
                            this.isTransitioning = false;
                        } else {
                            this.calculateResult();
                        }
                    }, 300);
                },

                goToDetail() {
                    this.step = 'result-detail';
                },
                backToSummary() {
                    this.step = 'result';
                    // è¿”å›æ¦‚è§ˆé¡µæ—¶é‡æ–°æ¸²æŸ“å›¾è¡¨
                    this.$nextTick(() => this.renderChart());
                },

                getScoreColorClass(score) {
                    if (score < 2) return 'text-green-600';
                    if (score < 3) return 'text-yellow-600';
                    if (score < 4) return 'text-orange-600';
                    return 'text-red-600';
                },
                getTextColorClass(score) {
                    return this.getScoreColorClass(score);
                },
                getLevelText(score) {
                    if(score < 2) return "æ­£å¸¸";
                    if(score < 3) return "è½»åº¦";
                    if(score < 4) return "ä¸­åº¦";
                    return "ä¸¥é‡";
                },
                getStatusBadgeClass(score) {
                    if(score < 2) return "bg-green-100 text-green-600";
                    if(score < 3) return "bg-yellow-100 text-yellow-700";
                    if(score < 4) return "bg-orange-100 text-orange-700";
                    return "bg-red-100 text-red-700";
                },
                getFactorDesc(name) {
                    return this.factorInfo[name] ? this.factorInfo[name].desc : '';
                },
                getFactorAnalysis(name, score) {
                    const info = this.factorInfo[name];
                    if (!info) return '';
                    if (score < 2) return info.analysis.low;
                    if (score < 3) return info.analysis.mid;
                    return info.analysis.high;
                },
                calculateResult() {
                    const getScore = (id) => this.answers[id - 1] || 1;
                    const calcSum = (ids) => ids.reduce((acc, id) => acc + getScore(id), 0);
                    const calcAvg = (ids) => calcSum(ids) / ids.length;

                    this.factors = this.factorDefinitions.map(f => ({ 
                        name: f.name, 
                        score: calcAvg(f.ids),
                        rawSum: calcSum(f.ids) 
                    }));
                    
                    this.step = 'result';
                    this.$nextTick(() => this.renderChart());
                },
                renderChart() {
                    const canvas = document.getElementById('radarChart');
                    if (!canvas) return;

                    const ctx = canvas.getContext('2d');
                    
                    // å…³é”®ï¼šé”€æ¯æ—§å®ä¾‹ï¼Œé˜²æ­¢é‡å 
                    if (this.chartInstance) {
                        this.chartInstance.destroy();
                        this.chartInstance = null;
                    }

                    const gradient = ctx.createRadialGradient(150, 150, 0, 150, 150, 150);
                    gradient.addColorStop(0, 'rgba(255, 36, 66, 0.1)');
                    gradient.addColorStop(1, 'rgba(255, 36, 66, 0.4)');

                    this.chartInstance = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: this.factors.map(f => f.name),
                            datasets: [{
                                label: 'å› å­åˆ†',
                                data: this.factors.map(f => f.score),
                                backgroundColor: gradient,
                                borderColor: '#FF2442',
                                borderWidth: 2,
                                pointBackgroundColor: '#fff',
                                pointBorderColor: '#FF2442',
                                pointRadius: 3
                            }]
                        },
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                r: {
                                    angleLines: { color: '#eee' },
                                    grid: { color: '#f0f0f0' },
                                    pointLabels: { 
                                        font: { size: 11, family: "'Noto Sans SC', sans-serif" },
                                        color: '#64748b'
                                    },
                                    suggestedMin: 0,
                                    suggestedMax: 4,
                                    ticks: { display: false }
                                }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                },
                downloadReport(elementId) {
                    const element = document.getElementById(elementId);
                    const originalOverflow = element.style.overflow;
                    element.style.overflow = 'visible'; 
                    
                    html2canvas(element, {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: "#F2F4F6",
                        ignoreElements: (el) => el.tagName === 'BUTTON'
                    }).then(canvas => {
                        element.style.overflow = originalOverflow;
                        const link = document.createElement('a');
                        link.download = 'å¿ƒç†ç”»åƒ_è¯¦ç»†åˆ†æ.png';
                        link.href = canvas.toDataURL("image/png");
                        link.click();
                        alert("âœ… æŠ¥å‘Šå·²ç”Ÿæˆï¼æ‰‹æœºè¯·æˆªå±ï¼Œç”µè„‘ç›´æ¥ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°ã€‚");
                    }).catch(() => {
                        element.style.overflow = originalOverflow;
                        alert("ç”Ÿæˆå›¾ç‰‡å¤±è´¥ï¼Œè¯·é‡è¯•");
                    });
                }
            }
        }).mount('#app');
    </script>
</body>
</html>